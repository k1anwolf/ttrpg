# TTRPG Combat Tracker - Реализованные функции

## Обзор
Расширенная система боевого трекера для настольных ролевых игр с полной поддержкой различных типов персонажей, продвинутой механикой действий и базой данных Supabase.

## Реализованные функции

### 1. Система типов персонажей ✅
- **Игрок (Player)**: Полное управление HP/MP, система спасбросков от смерти, воскрешение
- **НПС (NPC)**: Стандартное управление HP/MP, мгновенная смерть при 0 HP
- **Босс (Boss)**: Трекер полученного урона вместо HP, GM решает когда убить босса

### 2. Трекер урона для боссов ✅
- У боссов нет HP, только счетчик полученного урона
- Игроки видят сколько урона нанесено
- GM мануально решает когда босс умирает
- Отображается специальным индикатором с иконкой черепа

### 3. Система выбора целей для действий ✅
- **Одиночная цель**: Выбор одного персонажа
- **Множественные цели**: Выбор нескольких персонажей
- **AoE режим**: Применение эффектов ко всем выбранным целям
- Для каждой цели выбор результата проверки попадания:
  - Успех
  - Провал
  - Критический успех
  - Критический провал

### 4. Мануальное редактирование ✅
- **HP/MP**: Редактирование текущих и максимальных значений
- **Трекер урона босса**: Прямое редактирование значения
- **AC**: Изменение класса брони
- **Характеристики**: Редактирование всех 6 базовых характеристик (STR, DEX, CON, INT, WIS, CHA)

### 5. Мануальное убийство/воскрешение ✅
- Кнопка убийства для любого персонажа
- Кнопка воскрешения:
  - Для игроков: воскрешение с 1 HP
  - Для боссов: сброс полученного урона
- Визуальные индикаторы смерти

### 6. Механика тиков для эффектов и КД ✅
- **Эффекты по раундам**: Уменьшаются в начале каждого раунда
- **Эффекты по ходам**: Уменьшаются в начале хода конкретного персонажа
- **Кулдауны**: Уменьшаются каждый раунд
- Автоматическое снятие эффектов при достижении 0

### 7. Воскрешение игроков через спасброски ✅
- **3 успешных спасброска**: Автоматическое воскрешение с 1 HP
- **3 проваленных спасброска**: Окончательная смерть
- НПС и боссы не имеют спасбросков, умирают сразу
- Визуальный интерфейс с отслеживанием успехов/провалов

### 8. Система снаряжения ✅
- Доступна для игроков и НПС (не для боссов)
- Поддержка различных слотов (оружие, броня, аксессуары)
- Бонусы к характеристикам от снаряжения
- Возможность надевать/снимать снаряжение
- Бонусы отображаются как эффекты

### 9. Сброс боя ✅
- Сброс счетчиков раундов и ходов
- Снятие всех временных эффектов и статусов
- Сохранение статусов типа "до снятия"
- Сброс всех кулдаунов действий

### 10. Типы статусов ✅
- **Раунды (rounds)**: Длительность в раундах
- **Ходы (turns)**: Длительность в ходах конкретного персонажа
- **До снятия (until_removed)**: Не подвержены механике тиков, только мануальное снятие или снятие действием

### 11. Снятие статусов действиями ✅
- Действия могут иметь флаг `canRemoveStatus`
- Указание конкретного статуса для снятия
- Эффект `removeStatus` для снятия статуса с цели

## База данных Supabase

### Таблицы
1. **combat_sessions** - Боевые сессии
2. **participants** - Участники боя с поддержкой всех типов
3. **actions** - Действия (атаки, умения, заклинания)
4. **action_effects** - Эффекты действий
5. **statuses** - Активные статусы
6. **equipment** - Снаряжение персонажей
7. **event_logs** - Лог событий
8. **action_applications** - История применения действий
9. **action_targets** - Цели действий с результатами проверок

### Row Level Security (RLS)
- Все таблицы защищены RLS
- Пользователи видят только свои боевые сессии
- Полная изоляция данных между пользователями

## Компоненты

### Новые компоненты
- **TargetSelectionDialog** - Диалог выбора целей с проверками попадания
- **EquipmentManager** - Управление снаряжением
- **ManualEditDialog** - Мануальное редактирование параметров

### Обновленные компоненты
- **AddParticipantDialog** - Поддержка типов персонажей
- **HPBar** - Отображение урона для боссов
- **StatusManager** - Тип "до снятия"
- **DeathSaves** - Автоматическое воскрешение/смерть
- **ParticipantRow** - Все новые функции
- **CombatDashboard** - Механика тиков и сброс боя

## Использование

### Создание персонажа
1. Нажмите "Добавить"
2. Выберите тип персонажа (Игрок/НПС/Босс)
3. Заполните параметры (для босса HP не требуется)

### Применение действия
1. Нажмите на действие в карточке персонажа
2. Выберите цели
3. Для каждой цели выберите результат проверки
4. При необходимости активируйте режим AoE
5. Подтвердите применение

### Управление снаряжением
1. Нажмите кнопку со щитом на карточке персонажа
2. Добавьте предметы с бонусами к характеристикам
3. Наденьте/снимите предметы

### Ручное редактирование
1. Нажмите кнопку настроек на карточке персонажа
2. Вкладка "Ресурсы": HP, MP, урон босса, AC
3. Вкладка "Характеристики": STR, DEX, CON, INT, WIS, CHA

### Спасброски от смерти (только игроки)
1. Когда игрок без сознания, появляется панель спасбросков
2. Нажимайте "Успех" или "Провал"
3. При 3 успехах - воскрешение с 1 HP
4. При 3 провалах - окончательная смерть

### Сброс боя
1. Нажмите кнопку сброса в панели управления боем
2. Подтвердите действие
3. Все раунды, ходы и временные эффекты будут сброшены
4. Статусы "до снятия" сохраняются

## Демонстрационные данные
Приложение включает демо-данные:
- Арагорн (Игрок) - с атаками и умениями
- Гэндальф (Игрок) - с заклинаниями и AoE способностями
- Орк-воин (НПС) - базовые атаки
- Балрог (Босс) - трекер урона, мощные атаки

## Технический стек
- **Frontend**: React, TypeScript, TailwindCSS, shadcn/ui
- **Backend**: Express.js
- **Database**: Supabase PostgreSQL
- **State Management**: React hooks
- **Validation**: Zod

## Миграция данных
При загрузке сохраненных данных автоматически применяется миграция:
- Добавление поля `characterType`
- Добавление поля `damageTaken`
- Добавление поля `equipment`
- Обновление структуры действий с новыми полями
- Обновление статусов с полем `source`
